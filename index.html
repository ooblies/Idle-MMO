<html ng-app="idleApp" lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

    <!-- Angular -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.0/angular.min.js"></script>

    <!-- Local -->
    <link rel="stylesheet" type="text/css" href="style/main.css" />
    <link href="3rdParty/Font-Awesome/css/all.css" rel="stylesheet" />
    <link href="3rdParty/RPG-Awesome/css/rpg-awesome.css" rel="stylesheet" />
    <script src="js/constants.js"></script>
    <!-- Main -->
    <script src="js/main.js"></script>
</head>

<body ng-controller="idleController">
    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>Idle MMO</h3>
                <strong>IM</strong>
            </div>

            <ul class="list-unstyled components">
                <li>
                    <a href="#town">
                        <i class="fas fa-home"></i> Town
                    </a>
                </li>
            </ul>
            <ul class="components">
                <li class="active">
                    <a href="#characterSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle sidebar-dropdown-toggle">
                        <i class="fas fa-users"></i> Characters
                    </a>
                    <ul class="collapse show list-unstyled list-group-scroll" id="characterSubmenu">
                        <li class="animate-repeat" ng-repeat="character in data.characters">
                            <a href="#{{character.name}}-{{character.id}}"><i class="{{character.class.icon}}"></i> {{character.name}}({{character.level}})</a>
                        </li>
                        <li class="animate-repeat">
                            <a href="#create-character"><i class="fas fa-plus"></i>Create Character</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="components">
                <li class="active">
                    <a href="#dungeonSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle sidebar-dropdown-toggle">
                        <i class="fas fa-dungeon"></i> Dungeon
                    </a>
                    <ul class="collapse show list-unstyled list-group-scroll" id="dungeonSubmenu">
                        <li class="animate-repeat" ng-repeat="floor in [].constructor(data.dungeon.maxFloor) track by $index">
                            <a>Floor {{$index + 1}}</a>
                        </li>
                        <li class="animate-repeat">
                            <a ng-click="increaseMaxFloor();">Add Floor</a>
                        </li>
                    </ul>
                </li>
            </ul>

            <!-- To-Do: change this to a function to calculate thresholds based on CONSTANTS.Performance.tickRate -->
            <div class="performance fixed-bottom">
                <div ng-class="{'performance-ok':performance.timePerTick < 25,
                'performance-iffy':performance.timePerTick >= 25 && performance.timePerTick < 50,
                'performance-yikes':performance.timePerTick >= 50}">
                    {{performance.timePerTick}}ms per tick
                </div>
                <div class="progress" style="height: 2px; width:200px;">
                    <div id="#testid" class="progress-bar progress-bar-increasing" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="1000" onsubmit="ngFire('test1')"></div>
                </div>
            </div>

        </nav>

        <!-- Page Content  -->
        <div id="content" class="container-fluid">
            <section id="town">
                <img src="images/Town.png" />
                <div class="d-inline-flex flex-column">
                    <div class="dungeon-floor flex-column p-2" ng-repeat="floor in [].constructor(data.dungeon.maxFloor) track by $index">
                        <div class="p-2">
                            <h3>{{$index + 1}} {{CONSTANTS.dungeonFloors[$index].name}}</h3>
                        </div>
                        <div class="d-flex p-2">
                            <div class="p-2 mr-auto">
                                C
                            </div>
                            <div class="p-2" ng-repeat="enemy in data.dungeon.floors[$index] track by $index" ng-click="damageEnemy(this, 1);">
                                {{enemy.name}}

                                <div class="progress" style="height: 2px;">
                                    <div id="floor{{$parent.$index}}enemy{{$index}}" class="progress-bar health-bar" role="progressbar" aria-valuenow="{{enemy.currentHealth}}" aria-valuemin="0" aria-valuemax="{{enemy.health}}" onsubmit="ngFire('killEnemy',this)"></div>
                                </div>
                            </div>
                        </div>

                        <div class="progress" style="height: 2px;">
                            <div id="floor{{$parent.$index}}enemy{{$index}}" class="progress-bar progress-bar-increasing" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="5000" onsubmit="ngFire('regenerateFloorEnemies',this)"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section ng-repeat="character in data.characters track by $index" id="{{character.name}}-{{character.id}}">
                <h2>{{character.name}}</h2>
                <p>
                    Class: {{character.class.name}}
                    <br/> Level: {{character.level}}
                </p>
            </section>
            <section id="create-character">
                <h2>Create Character</h2>
                <form id="formCreateCharacter" class="needs-validation" novalidate ng-submit="createCharacter()">
                    <div class="form-group row">
                        <label for="createCharacterFormName" class="col-sm-2 col-form-label">Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="createCharacterFormName" placeholder="Name..." required autocomplete="off">
                            <div class="invalid-feedback">
                                Please enter a name.
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="createCharacterFormClass" class="col-sm-2 col-form-label">Class</label>
                        <div class="col-sm-10">
                            <select class="custom-select" id="createCharacterFormClass" required>
                                <option invalid disabled selected value="">Choose...</option>
                                <option ng-repeat="class in CONSTANTS.classes track by $index" value="{{$index}}">{{class.name}}</option>                      
                            </select>
                            <div class="invalid-feedback">
                                Please select a class.
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-primary">Create</button>
                        </div>
                    </div>
                </form>

            </section>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#sidebarCollapse').on('click', function() {
                $('#sidebar').toggleClass('active');
            });
        });
    </script>
</body>

</html>